# Devlog 08/03/2023

```text
(Week 2, Saturday)
tags: #os, #setup, #camera
```

## Notes

- Continuing on from previous devlog
- Git
  - Synced `seafaring_RMS` to latest master on `RMS`
  - Pulled from latest master branch (on `seafaring_RMS`)
- **Install `ephem` instead of `pyephem`**
  - `pyephem` is a stub
- Verified camera still works
  - On new `12v 1.5A` external HDD PSUs
  - Using RTSP link `rtsp://192.168.42.10/user=admin&password=&channel=1&stream=0.sdp?real_stream` on VLC
    - Also works without the `?real_stream`
- Verifying camera with `gstreamer`
  - `gst-launch-1.0 rtspsrc location="rtsp://192.168.42.10/user=admin&password=&channel=1&stream=0.sdp" ! rtph264depay ! h264parse ! decodebin ! autovideosink`
  - `gst-launch-1.0 rtspsrc location="rtsp://192.168.42.10/user=admin&password=&channel=1&stream=0.sdp" latency=100 ! queue ! rtph264depay ! h264parse ! avdec_h264 ! videoconvert ! videoscale ! video/x-raw,width=640,height=480 ! autovideosink`
  - Happy as can be

## [Software Installation using the GitHub instructions](https://github.com/CroatianMeteorNetwork/RMS#setting-up)

- Installation dir used in the manual is `/home/pi/RMS`
  - Mine will be `/home/kurt/code/seafaring_RMS/`

----------------------------
----------------------------

## Issues Encountered

### **Python Versioning**

- `3.11`
  - `cython`, `matplotlib`, `numpy`, `scipy` not supported
- `3.10`
  - Issues with installing `imageio` and `pyephem`
- `3.8`
  - This is the one we'll use
- `3.6`
  - Too old, don't bother ig

#### Solving Environment Failed (Conda)

#### Corrected Installation Command

```bash
conda install -y numpy scipy gitpython cython matplotlib
conda install -y -c conda-forge ephem Pillow imreg_dft imageio pyqtgraph'<=0.12.1'
conda install -y -c astropy astropy
pip install rawpy
```

#### **Solution**

- Installed in `python 3.8`
- Changed installation of `pyephem` to `ephem`
  - [See this link for details on why](https://pypi.org/project/pyephem/)

### **OpenCV installation issues**

- Pain + agony
- Was unable to install and compile on versions:
  - `4.1.2`
  - `4.5.5`
- After trying numerous
  - `cmake` flags
  - OpenCV versions
  - Ways of downloading OpenCV
- Got it to work on OpenCV `4.7.0`, opencv-contrib `4.x`, python `3.8.16` with all dependencies installed
  - See the [installer script I wrote](./../../opencv4_install_pro_max.sh)

### gstreamer

- Doesn't want to show `rtsp` video from the camera
  - Does so all fine if you deactivate the conda env
    - Due to installation from the big `sudo apt-get` command list in the opencv4 install
    - Works fine in a fresh conda environment
  - But trying to run it in the `RMS_3_8` conda env will not work

#### Working gstreamer env

- In conda env `gst_1_0` (corresponding to raw gstreamer 1.20.3 install)
- All commands run to install it in the conda env are below:

```bash
conda create -n gst_1_0
conda activate gst_1_0

# conda search -c conda-forge -f gstreamer
conda install -y -c conda-forge gstreamer=1.20.3

conda install -y -c conda-forge gst-plugins-base gst-plugins-good
conda install -y -c conda-forge gst-plugins-bad

# Unsure if necessary
conda install -y -c conda-forge gst-plugins-ugly

conda install -y -c conda-forge gst-libav

gst-launch-1.0 rtspsrc location="rtsp://192.168.42.10/user=admin&password=&channel=1&stream=0.sdp" ! rtph264depay ! h264parse ! decodebin ! autovideosink
```

**Above commands can be simplified to the following:**

```bash
conda install -y -c conda-forge gstreamer=1.20.3
conda install -y -c conda-forge gst-plugins-base gst-plugins-good gst-plugins-bad gst-plugins-ugly gst-libav
gst-launch-1.0 rtspsrc location="rtsp://192.168.42.10/user=admin&password=&channel=1&stream=0.sdp" ! rtph264depay ! h264parse ! decodebin ! autovideosink
```

#### Possible Solutions

- Make sure gstreamer is never installed into the conda env?
-

## TODO

- [X] Stash all unnecessary garbage in my repo
- [ ] Push to GitHub
  - [ ] Push most changes
  - [ ] Push majority of config file (excluding GPS location)
  - [ ] Add `.config` to `.gitignore`
  - [ ] Add GPS location to `.config`
- [X] Fix `gstreamer` issues
  - [ ] Installed thru conda not regular
  - [ ] Might need to uninstall thru conda or just remove it
  - [ ] <https://stackoverflow.com/questions/60850626/gstreamer-rtsp-on-ubuntu-warning-erroneous-pipeline-no-element-rtspsrc>
    - [ ] h264 module too
